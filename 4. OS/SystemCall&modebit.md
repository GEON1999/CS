# 시스템 콜(System Call)과 모드 비트(Mode Bit)

## 시스템 콜의 개념

시스템 콜(System Call)은 **운영체제가 커널에 접근하기 위한 인터페이스**입니다. 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 시스템 콜을 거쳐서 호출하도록 설계되어 있습니다.

시스템 콜은 다음과 같은 경우에 사용됩니다:

- 프로세스 관리(생성, 삭제 등)
- 파일 관리
- 디바이스 관리
- 시간 및 날짜 관련 시스템
- 프로세스 간 통신

> **예시**: 프로세스를 종료하는 `kill()` 함수를 호출하면 시스템 콜을 거쳐서 커널 함수가 호출됩니다.

## 시스템 콜의 처리 과정

유저 프로그램이 I/O 요청을 위한 트랩(trap)을 발동했을 때 다음과 같은 과정이 발생합니다:

1. 유저 프로그램이 I/O 요청 트랩을 발동
2. 운영체제가 올바른 I/O 요청인지 확인
3. 유저 모드가 시스템 콜을 통해 커널 모드로 전환
4. 커널 함수 실행 (예: `fs.readFile()`)
5. 작업 완료 후 유저 모드로 복귀

## 관련 개념

### 커널 함수

커널 안에 있는 여러 함수를 의미합니다. 이를 네이티브 함수(native function)라고도 합니다. 시스템의 핵심 기능을 수행하는 저수준 함수들입니다.

### 커널(Kernel)

운영체제의 핵심 부분으로, 다음과 같은 역할을 담당합니다:

- 시스템 콜 제공
- 보안 관리
- 메모리 관리
- 프로세스 관리
- 파일 시스템 관리
- I/O 디바이스 관리
- I/O 요청 관리

커널은 컴퓨터 하드웨어와 응용 프로그램 사이의 중개자 역할을 하며, 시스템의 안정성과 보안을 유지하는 데 중요한 역할을 합니다.

### 유저 모드(User Mode)

유저가 접근할 수 있는 영역을 제한적으로 두며, 컴퓨터 자원에 함부로 접근하지 못하게 하는 모드입니다. 일반 응용 프로그램은 이 모드에서 실행됩니다.

유저 모드에서는:

- 제한된 명령어만 실행 가능
- 하드웨어에 직접 접근 불가
- 메모리의 특정 영역만 접근 가능

### 커널 모드(Kernel Mode)

모든 컴퓨터 자원에 접근할 수 있는 모드입니다. 운영체제의 핵심 서비스는 이 모드에서 실행됩니다.

커널 모드에서는:

- 모든 CPU 명령어 실행 가능
- 모든 하드웨어 직접 접근 가능
- 전체 메모리 영역 접근 가능

## 모드 비트(Mode Bit)

시스템 콜이 작동될 때 모드 비트(mode bit)를 기반으로 유저 모드와 커널 모드를 구분합니다. 모드 비트는 1 또는 0의 값을 가지는 플래그 변수입니다:

- **1**: 유저 모드
- **0**: 커널 모드

모드 비트는 CPU의 상태 레지스터에 저장되며, 시스템 콜이 발생할 때마다 이 값이 변경됩니다.

## 시스템 콜의 장점

1. **추상화**: 유저 프로그램은 시스템 콜을 통해 커널과 분리되어, 복잡한 내부 동작을 신경 쓸 필요가 없습니다.
2. **보안 강화**: 운영체제의 관리하에 프로그램이 운영되므로 시스템의 안정성과 보안이 강화됩니다.
3. **자원 보호**: 중요한 시스템 자원에 대한 무단 접근을 방지합니다.
4. **하드웨어 독립성**: 하드웨어가 변경되어도 시스템 콜 인터페이스는 동일하게 유지될 수 있습니다.

## 실제 사용 예시와 보안 중요성

공격자가 만든 카메라 앱 프로그램이 제약 없이 커널에 접근할 수 있다면, 카메라 관련 메모리가 오염되어 사용자의 의도와 관계없이 카메라가 켜지고 사생활이 노출될 수 있습니다.

이러한 보안 위협을 방지하기 위해 운영체제는 유저 모드에서 시스템 콜만을 통해 커널 모드에 진입할 수 있는 단 하나의 통로를 제공합니다. 이를 통해 모든 시스템 자원 접근이 운영체제의 통제 하에 이루어지게 됩니다.

## 주요 시스템 콜 종류

### 프로세스 제어

- `fork()`: 새로운 프로세스 생성
- `exit()`: 프로세스 종료
- `wait()`: 자식 프로세스가 종료될 때까지 대기

### 파일 관리

- `open()`: 파일 열기
- `read()`: 파일 읽기
- `write()`: 파일 쓰기
- `close()`: 파일 닫기

### 디바이스 관리

- `ioctl()`: 디바이스 제어
- `read()`, `write()`: 디바이스 읽기/쓰기

### 정보 유지

- `getpid()`: 프로세스 ID 얻기
- `alarm()`: 알람 설정
- `sleep()`: 프로세스 일시 중지

### 통신

- `pipe()`: 파이프 생성
- `shmget()`: 공유 메모리 세그먼트 생성
- `mmap()`: 메모리 맵 파일
